<!DOCTYPE html>

<html>

<header>
<title>Silver Behenate Diffraction Simulator</title>
<script type="text/javascript">

function draw() {
   var detdist = parseFloat(document.getElementById("detdist").value);
   var apix = parseFloat(document.getElementById("apix").value);
   var detsize = parseFloat(document.getElementById("detsize").value);
   var wavelength = parseFloat(document.getElementById("wavelength").value);

   var canvas = document.getElementById("rings");
   var ctx = canvas.getContext("2d");

   var nx = detsize, ny = detsize;
   canvas.width = canvas.height = detsize;

   var img_data = ctx.createImageData(ny, nx);

   var idx = 0;
   for (var i = 0; i < ny; i++) {
      var iy = (i - ny / 2.0)
      var sy = iy / ny / apix;
      var ry = iy * apix;
      var iy2 = iy * iy;
      var sy2 = sy * sy;
      var ry2 = ry * ry;
      for (var j = 0; j < nx; j++) {
         var ix = (j - nx / 2)
         var sx = ix / nx / apix;
         var rx = ix * apix;
         var i2 = iy2 + ix * ix;
         var s2 = sy2 + sx * sx;
         var r2 = ry2 + rx * rx;

         var d = Math.sqrt(r2);

         var color = 0;
         if (d < 5 ) {
            color = 255;
         }
         if (color < 0) color = 0;
         if (color > 255) color = 255;

         img_data.data[idx    ] = color; // R
         img_data.data[idx + 1] = color; // G
         img_data.data[idx + 2] = color; // B
         img_data.data[idx + 3] = 255;   // A

         if (i2 > 0) {
            var resol = Math.sqrt(i2);
            for (var k = 1; k < 14; k++) {
                ds = k * 0.0171;
                iring = detdist * Math.tan(2.0 * Math.asin(ds * wavelength * 10. / 2.0)) / apix;
                if (Math.abs(resol - iring) < 1) {
                    img_data.data[idx] = 255;
                    img_data.data[idx + 1] = 0;
                    img_data.data[idx + 2] = 0;
                }
            }
         }

         idx += 4;
      }
   }

   ctx.putImageData(img_data, 0, 0);
}
</script>
</header>

<body>

<h1>Silver Behenate Rings Simulator</h1>
<p>This interactive page allows you to simulate Silver Behenate rings as they would appear on an LCLS detector.</p>

<form>
    <label>Detector distance (in mm): <input id="detdist" min="1" max="300" value="60"></label><br>
    <label>Pixel size (in mm): <input id="apix" min="0.01" max="10" value="0.1"></label><br>
    <label>Detector size (in pixels): <input id="detsize" min="100" max="2000" value="1000" step="1"></label><br>
    <label>Wavelength (in nm): <input id="wavelength" min="0.05" max="10" value="0.15"></label><br>
<button type="button" value="Draw" onClick="draw()">Draw</button>
</form>
<canvas id="rings" width=512 height=512 style="border:1px solid black">
</canvas>

<footer>
<p>This page was inspired by CTF calculator written by Takanori Nakane at MRC-LMB: https://3dem.github.io/relion/ctf.html. This page uses Javascript for calculation.</p>
</footer>
</body>
</html>