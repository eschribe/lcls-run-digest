<!DOCTYPE html>

<html>

<header>
<title>Silver Behenate Diffraction Simulator</title>
<script type="text/javascript">

function electron_wavelength(U) { // U in [V], returns in [Angstrom]
   var h =  6.626E-34 // Planck constant [Js] = [kgm^2/s]
   var e =  1.602E-19 // electron charge [C]; note that [CV] = [J]
   var c =  3.000E8   // speed of light [m/s]
   var m0 = 9.109E-31 // electron rest mass [kg]

   return h / Math.sqrt(2 * m0 * e * U) / Math.sqrt(1 + e * U / (2 * m0 * c * c)) * 1E10
}

function draw() {
   var detdist = parseFloat(document.getElementById("detdist").value);
   var detsize = 1000;
   var apix = 1;

   var canvas = document.getElementById("rings");
   var ctx = canvas.getContext("2d");

   var nx = detsize, ny = detsize;
   canvas.width = canvas.height = detsize;

   var img_data = ctx.createImageData(ny, nx);

   var idx = 0;
   for (var i = 0; i < ny; i++) {
      var sy = (i - ny / 2.0) / ny / apix;
      var ry = (i - ny / 2.0) * apix;
      var sy2 = sy * sy;
      var ry2 = ry * ry;
      for (var j = 0; j < nx; j++) {
         var sx = (j - nx / 2) / nx / apix;
         var rx = (j - nx / 2) * apix;
         var s2 = sy2 + sx * sx;
         var r2 = ry2 + rx * rx;

         var color = 0;
         if (r2 < 10 ) {
            color = 255;
         }
         if (color < 0) color = 0;
         if (color > 255) color = 255;

         img_data.data[idx    ] = color; // R
         img_data.data[idx + 1] = color; // G
         img_data.data[idx + 2] = color; // B
         img_data.data[idx + 3] = 255;   // A

         if (s2 > 0) {
            var resol = Math.sqrt(1.0 / s2);
            if (Math.abs(resol - 10) < 0.02) {
               img_data.data[idx    ] = 255;
               img_data.data[idx + 1] = 0;
               img_data.data[idx + 2] = 0;
            }
         }

         idx += 4;
      }
   }

   ctx.putImageData(img_data, 0, 0);
}
</script>
</header>

<body>

<h1>Silver Behenate Rings Simulator</h1>
<p>This interactive page allows you to simulate Silver Behenate rings as they would appear on an LCLS detector.</p>

<form>
    <label>Detector distance (in mm): <input id="detdist" min="1" max="300" value="60"></label><br>
<button type="button" value="Draw" onClick="draw()">Draw</button>
</form>
<canvas id="rings" width=512 height=512 style="border:1px solid black">
</canvas>

<footer>
<p>This page was inspired by CTF calculator written by Takanori Nakane at MRC-LMB: https://3dem.github.io/relion/ctf.html. This page uses Javascript for calculation.</p>
</footer>
</body>
</html>